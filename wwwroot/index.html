<!DOCTYPE html>
<html>
<head>
    <title>Planner System</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://jqwidgets.com/public/jqwidgets/styles/jqx.base.css">
    <link rel="stylesheet" href="/css/animations.css">
    <script src="https://jqwidgets.com/public/jqwidgets/jqx-all.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .header {
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header-title {
            font-weight: bold;
            font-size: 22px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .logout-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

            .logout-btn:hover {
                background: linear-gradient(135deg, #ff5252, #e74c3c);
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
            }

        #tabs {
            height: calc(100vh - 70px);
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .jqx-tabs-header {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .jqx-tabs-title {
            color: white !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }

            .jqx-tabs-title:hover {
                background: rgba(255, 255, 255, 0.15) !important;
                transform: translateY(-2px);
            }

        .jqx-tabs-title-selected {
            background: linear-gradient(135deg, #6d28d9, #4f46e5) !important;
            box-shadow: 0 4px 15px rgba(109, 40, 217, 0.4);
        }

        .grid-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            height: calc(100% - 40px);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        .stats-panel {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

            .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                background: rgba(255, 255, 255, 0.2);
            }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-title">📅 Planner System Dashboard</div>
        <button class="logout-btn" onclick="logout()">🚪 Выйти</button>
    </div>

    <div class="stats-panel">
        <div class="stat-card">
            <div class="stat-value" id="total-tasks">0</div>
            <div class="stat-label">Всего задач</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="active-tasks">0</div>
            <div class="stat-label">Активных задач</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="total-resources">0</div>
            <div class="stat-label">Ресурсов</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="completed-tasks">0</div>
            <div class="stat-label">Завершено</div>
        </div>
    </div>

    <div id='tabs'>
        <ul>
            <li>📊 Resources</li>
            <li>✅ Tasks</li>
            <li>🕐 Shifts</li>
            <li>📅 Schedule</li>
            <li>📈 Analytics</li>
        </ul>

        <div class="grid-container">
            <div id="resourceGrid"></div>
        </div>
        <div class="grid-container">
            <div id="taskGrid"></div>
        </div>
        <div class="grid-container">
            <div id="shiftGrid"></div>
        </div>
        <div class="grid-container">
            <div id="shiftTaskGrid"></div>
        </div>
        <div class="grid-container">
            <div id="analyticsChart" style="height: 400px;"></div>
            <div style="display: flex; gap: 20px; margin-top: 20px;">
                <div style="flex: 1; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3>📋 Задачи по статусу</h3>
                    <div id="taskStatusChart" style="height: 200px;"></div>
                </div>
                <div style="flex: 1; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3>👥 Распределение по ресурсам</h3>
                    <div id="resourceDistributionChart" style="height: 200px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/animations.js"></script>
    <script>
        function logout() {
            fetch('/Account/Logout', {
                method: 'POST',
                credentials: 'include'
            }).then(response => {
                window.location.href = '/Account/Login';
            });
        }

        // Обновление статистики
        function updateStats() {
            fetch('/Task')
                .then(response => response.json())
                .then(tasks => {
                    document.getElementById('total-tasks').textContent = tasks.length;
                    const activeTasks = tasks.filter(t =>
                        new Date(t.time_pref_finish) > new Date() &&
                        new Date(t.time_pref_start) <= new Date()
                    ).length;
                    document.getElementById('active-tasks').textContent = activeTasks;
                    document.getElementById('completed-tasks').textContent = tasks.length - activeTasks;
                });

            fetch('/Resource')
                .then(response => response.json())
                .then(resources => {
                    document.getElementById('total-resources').textContent = resources.length;
                });
        }

        $(function () {
            updateStats();
            setInterval(updateStats, 30000);

            // Инициализация сеток (остальной код остается как в оригинале)
            var initResourceGrid = function () {
                // ... существующий код ...
            };

            var initTaskGrid = function () {
                // ... существующий код ...
            };

            var initShiftGrid = function () {
                // ... существующий код ...
            };

            var initShiftTaskGrid = function () {
                // ... существующий код ...
            };

            var initAnalyticsTab = function () {
                // Инициализация графиков аналитики
                $('#analyticsChart').jqxChart({
                    title: '📈 Продуктивность по дням',
                    description: 'Анализ выполнения задач',
                    showLegend: true,
                    enableAnimations: true,
                    animationDuration: 1000,
                    padding: { left: 5, top: 5, right: 5, bottom: 5 },
                    titlePadding: { left: 90, top: 0, right: 0, bottom: 10 },
                    source: [],
                    xAxis: {
                        dataField: 'day',
                        showGridLines: true
                    },
                    seriesGroups: [
                        {
                            type: 'line',
                            valueAxis: {
                                displayValueAxis: true,
                                description: 'Количество задач',
                                axisSize: 'auto'
                            },
                            series: [
                                { dataField: 'completed', displayText: 'Завершено' },
                                { dataField: 'pending', displayText: 'В процессе' }
                            ]
                        }
                    ]
                });

                // Загрузка данных для графиков
                fetch('/ShiftTask/GetShiftTasks')
                    .then(response => response.json())
                    .then(data => {
                        // Обработка данных для графиков
                        // ... код для подготовки данных ...
                    });
            };

            var initWidgets = function (tab) {
                switch (tab) {
                    case 0:
                        initResourceGrid();
                        break;
                    case 1:
                        initTaskGrid();
                        break;
                    case 2:
                        initShiftGrid();
                        break;
                    case 3:
                        initShiftTaskGrid();
                        break;
                    case 4:
                        initAnalyticsTab();
                        break;
                }
            };

            $('#tabs').jqxTabs({
                width: '100%',
                height: '100%',
                initTabContent: initWidgets,
                position: 'top',
                animationType: 'fade'
            });

            // Добавляем анимации для вкладок
            $('#tabs').on('selected', function (event) {
                $('.grid-container').addClass('fade-in');
                setTimeout(() => {
                    $('.grid-container').removeClass('fade-in');
                }, 500);
            });
        });
    </script>
</body>
</html>